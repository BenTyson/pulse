---
interface Props {
  variant?: 'inline' | 'card';
  heading?: string;
  description?: string;
}

const {
  variant = 'card',
  heading = 'Stay in the loop',
  description = 'Get the latest graphene news delivered to your inbox every week. Join researchers, investors, and industry professionals.',
} = Astro.props;
---

{variant === 'card' ? (
  <div class="border border-border rounded-lg p-8">
    <div class="max-w-xl mx-auto text-center">
      <h3 class="text-2xl font-semibold text-white mb-3">
        {heading}
      </h3>
      <p class="text-text-secondary mb-6">
        {description}
      </p>
      <form class="flex flex-col sm:flex-row gap-3" id="newsletter-form">
        <input
          type="email"
          name="email"
          placeholder="Enter your email"
          required
          class="flex-1 px-4 py-3 bg-bg-surface border border-border rounded-md text-text-primary placeholder:text-text-muted focus:outline-none focus:border-silver-dark transition-colors"
        />
        <button
          type="submit"
          class="px-6 py-3 bg-white text-black font-medium rounded-md hover:bg-silver-light transition-colors"
        >
          Subscribe
        </button>
      </form>
      <p class="text-text-muted text-sm mt-4">
        Free forever. Unsubscribe anytime.
      </p>
    </div>
  </div>
) : (
  <form class="flex flex-col sm:flex-row gap-3" id="newsletter-form-inline">
    <input
      type="email"
      name="email"
      placeholder="Enter your email"
      required
      class="flex-1 px-4 py-3 bg-bg-surface border border-border rounded-md text-text-primary placeholder:text-text-muted focus:outline-none focus:border-silver-dark transition-colors"
    />
    <button
      type="submit"
      class="px-6 py-3 bg-white text-black font-medium rounded-md hover:bg-silver-light transition-colors whitespace-nowrap"
    >
      Subscribe
    </button>
  </form>
)}

<script>
  const forms = document.querySelectorAll('#newsletter-form, #newsletter-form-inline');

  forms.forEach((form) => {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target as HTMLFormElement);
      const email = formData.get('email');

      const button = form.querySelector('button[type="submit"]') as HTMLButtonElement;
      const originalText = button.textContent;
      button.textContent = 'Subscribing...';
      button.disabled = true;

      try {
        const response = await fetch('/api/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email }),
        });

        if (response.ok) {
          button.textContent = 'Subscribed!';
          (e.target as HTMLFormElement).reset();
        } else {
          throw new Error('Subscription failed');
        }
      } catch {
        button.textContent = 'Error';
        setTimeout(() => {
          button.textContent = originalText;
          button.disabled = false;
        }, 2000);
      }
    });
  });
</script>
