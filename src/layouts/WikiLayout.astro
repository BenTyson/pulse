---
import BaseLayout from './BaseLayout.astro';
import WikiNav from '../components/WikiNav.astro';
import type { WikiPage } from '../lib/database.types';

interface Props {
  page: WikiPage;
}

const { page } = Astro.props;

const currentSlug = page.slug;
---

<BaseLayout
  title={page.title}
  description={page.meta_description || page.excerpt || undefined}
>
  <div class="py-12">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-[220px_1fr] gap-16">
        <!-- Sidebar -->
        <aside class="hidden lg:block">
          <WikiNav currentSlug={currentSlug} />
        </aside>

        <!-- Main Content -->
        <main class="min-w-0 max-w-3xl">
          <!-- Breadcrumb -->
          <nav class="flex items-center gap-2 text-sm text-text-muted mb-8">
            <a href="/" class="hover:text-silver transition-colors">Home</a>
            <span class="text-text-muted/50">/</span>
            <a href="/wiki" class="hover:text-silver transition-colors">Wiki</a>
          </nav>

          <!-- Title -->
          <h1 class="text-3xl md:text-4xl font-bold text-silver-bright mb-8 leading-tight">
            {page.title}
          </h1>

          <!-- Content -->
          <div class="wiki-content">
            <slot />
          </div>

          <!-- Last Updated -->
          <div class="mt-16 pt-8 border-t border-border">
            <p class="text-text-muted text-sm">
              Last updated: {new Date(page.updated_at).toLocaleDateString('en-US', {
                month: 'long',
                day: 'numeric',
                year: 'numeric',
              })}
            </p>
          </div>
        </main>
      </div>
    </div>
  </div>
</BaseLayout>

<style is:global>
  .wiki-content {
    color: var(--color-text-secondary);
    font-size: 1.0625rem;
    line-height: 1.75;
  }

  .wiki-content p {
    margin-bottom: 1.25em;
  }

  .wiki-content h2 {
    color: var(--color-silver-bright);
    font-size: 1.5rem;
    font-weight: 600;
    margin-top: 2.5em;
    margin-bottom: 0.75em;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--color-border);
  }

  .wiki-content h2:first-child {
    margin-top: 0;
  }

  .wiki-content h3 {
    color: var(--color-silver-bright);
    font-size: 1.25rem;
    font-weight: 600;
    margin-top: 2em;
    margin-bottom: 0.5em;
  }

  .wiki-content h4 {
    color: var(--color-silver-bright);
    font-size: 1.125rem;
    font-weight: 600;
    margin-top: 1.5em;
    margin-bottom: 0.5em;
  }

  .wiki-content a {
    color: var(--color-silver);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .wiki-content a:hover {
    color: var(--color-silver-bright);
  }

  .wiki-content strong {
    color: var(--color-silver-bright);
    font-weight: 600;
  }

  .wiki-content code {
    background: var(--color-bg-surface);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
  }

  .wiki-content pre {
    background: var(--color-bg-surface);
    border-radius: 0.5rem;
    padding: 1rem;
    overflow-x: auto;
  }

  .wiki-content blockquote {
    border-left: 3px solid var(--color-silver-dark);
    color: var(--color-text-secondary);
    padding-left: 1.25rem;
    margin: 1.5rem 0;
    font-style: italic;
  }

  .wiki-content ul {
    list-style-type: disc;
    padding-left: 1.5rem;
    margin-bottom: 1.25em;
  }

  .wiki-content ol {
    list-style-type: decimal;
    padding-left: 1.5rem;
    margin-bottom: 1.25em;
  }

  .wiki-content li {
    margin-bottom: 0.5rem;
    padding-left: 0.25rem;
  }

  .wiki-content li::marker {
    color: var(--color-text-muted);
  }

  .wiki-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
  }

  .wiki-content th,
  .wiki-content td {
    padding: 0.75rem;
    border: 1px solid var(--color-border);
    text-align: left;
  }

  .wiki-content th {
    background: var(--color-bg-surface);
    color: var(--color-silver-bright);
    font-weight: 600;
  }

  .wiki-content img {
    border-radius: 0.5rem;
    margin: 2rem auto;
  }

  .wiki-content hr {
    border: none;
    border-top: 1px solid var(--color-border);
    margin: 2rem 0;
  }
</style>
